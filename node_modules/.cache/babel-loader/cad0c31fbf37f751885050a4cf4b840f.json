{"ast":null,"code":"import _toConsumableArray from\"/Users/nguyencanhnguyen/Public/Development/condi-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/nguyencanhnguyen/Public/Development/condi-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useEffect,useState}from\"react\";import{withFormik}from\"formik\";import*as Yup from\"yup\";import TagList from\"./components/TagList\";import{getArticleBySlug,postArticle,putArticle}from\"./apis\";import{useHistory,useParams}from\"react-router\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function Editor(props){var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),input=_useState2[0],setInput=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),tags=_useState4[0],setTags=_useState4[1];var token=window.localStorage.getItem(\"jwtToken\");var _useParams=useParams(),slug=_useParams.slug;var setFieldValue=props.setFieldValue;var history=useHistory();var handleSubmit=function handleSubmit(e){e.preventDefault();if(!slug){postArticle(props.values,tags,token).then(function(res){var slug=res.data.article.slug;history.push(\"/article/\".concat(slug));});}else{putArticle(props.values,tags,token,slug).then(function(res){history.push(\"/article/\".concat(slug));});}};useEffect(function(){if(slug){getArticleBySlug(slug).then(function(res){var article=res.data.article;setFieldValue(\"title\",article.title);setFieldValue(\"description\",article.description);setFieldValue(\"content\",article.body);setTags(article.tagList);});}},[slug,setFieldValue]);var onKeyDown=function onKeyDown(e){var key=e.key;var trimmedInput=input.trim();if(key===\"Enter\"&&trimmedInput.length&&!(tags===null||tags===void 0?void 0:tags.includes(trimmedInput))){e.preventDefault();setTags(function(prevState){return[].concat(_toConsumableArray(prevState),[trimmedInput]);});setInput(\"\");}if(key===\"Backspace\"&&!input.length&&tags.length){e.preventDefault();var tagsCopy=_toConsumableArray(tags);var poppedTag=tagsCopy.pop();setTags(tagsCopy);setInput(poppedTag);}};var onChange=function onChange(e){var value=e.target.value;setInput(value);};var onKeyUp=function onKeyUp(){};return/*#__PURE__*/_jsx(\"div\",{className:\"editor-page\",children:/*#__PURE__*/_jsx(\"div\",{className:\"container page\",children:/*#__PURE__*/_jsx(\"div\",{className:\"row\",children:/*#__PURE__*/_jsx(\"div\",{className:\"col-md-10 offset-md-1 col-xs-12\",children:/*#__PURE__*/_jsx(\"form\",{onSubmit:handleSubmit,children:/*#__PURE__*/_jsxs(\"fieldset\",{children:[/*#__PURE__*/_jsxs(\"fieldset\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"error-messages\",children:props.errors.title}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control form-control-lg\",placeholder:\"Article Title\",name:\"title\",value:props.values.title,onChange:props.handleChange})]}),/*#__PURE__*/_jsxs(\"fieldset\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"error-messages\",children:props.errors.description}),/*#__PURE__*/_jsx(\"textarea\",{rows:6,className:\"form-control\",placeholder:\"What's this article about?\",name:\"description\",value:props.values.description,onChange:props.handleChange})]}),/*#__PURE__*/_jsxs(\"fieldset\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"error-messages\",children:props.errors.content}),/*#__PURE__*/_jsx(\"textarea\",{rows:6,className:\"form-control\",placeholder:\"Write your article (in markdown)\",name:\"content\",value:props.values.content,onChange:props.handleChange})]}),/*#__PURE__*/_jsxs(\"fieldset\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"form-control\",placeholder:slug?\"Don't change tags\":\"Enter tags\",value:input,onKeyDown:onKeyDown,onChange:onChange,onKeyUp:onKeyUp}),/*#__PURE__*/_jsx(TagList,{tags:tags,setTags:setTags})]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-lg pull-xs-right btn-primary\",disabled:!props.isValid||!props.values.title,children:\"Publish Article\"})]})})})})})});}var FormikEditor=withFormik({mapPropsToValues:function mapPropsToValues(){// Init form field\nreturn{title:\"\",description:\"\",content:\"\"};},validationSchema:Yup.object().shape({// Validate form field\ntitle:Yup.string().required(\"Please provide a title\"),description:Yup.string().required(\"Please provide a description\"),content:Yup.string().required(\"Please provide content\")}),handleSubmit:function handleSubmit(){}})(Editor);export default FormikEditor;","map":{"version":3,"sources":["/Users/nguyencanhnguyen/Public/Development/condi-app/src/pages/Editor/index.tsx"],"names":["useEffect","useState","withFormik","Yup","TagList","getArticleBySlug","postArticle","putArticle","useHistory","useParams","Editor","props","input","setInput","tags","setTags","token","window","localStorage","getItem","slug","setFieldValue","history","handleSubmit","e","preventDefault","values","then","res","data","article","push","title","description","body","tagList","onKeyDown","key","trimmedInput","trim","length","includes","prevState","tagsCopy","poppedTag","pop","onChange","value","target","onKeyUp","errors","handleChange","content","isValid","FormikEditor","mapPropsToValues","validationSchema","object","shape","string","required"],"mappings":"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","sourcesContent":["import {\n  ChangeEvent,\n  KeyboardEvent,\n  SyntheticEvent,\n  useEffect,\n  useState,\n} from \"react\";\nimport { InjectedFormikProps, withFormik } from \"formik\";\nimport * as Yup from \"yup\";\nimport TagList from \"./components/TagList\";\nimport { getArticleBySlug, postArticle, putArticle } from \"./apis\";\nimport { useHistory, useParams } from \"react-router\";\nimport { FormProps, FormValues, Slug } from \"./interface\";\n\nfunction Editor(props: InjectedFormikProps<FormProps, FormValues>) {\n  const [input, setInput] = useState(\"\");\n  const [tags, setTags] = useState<String[]>([]);\n  const token = window.localStorage.getItem(\"jwtToken\");\n  const { slug } = useParams<Slug>();\n  const { setFieldValue } = props;\n  const history = useHistory();\n  const handleSubmit = (e: SyntheticEvent) => {\n    e.preventDefault();\n    if (!slug) {\n      postArticle(props.values, tags, token).then((res) => {\n        const slug = res.data.article.slug;\n        history.push(`/article/${slug}`);\n      });\n    } else {\n      putArticle(props.values, tags, token, slug).then((res) => {\n        history.push(`/article/${slug}`);\n      });\n    }\n  };\n\n  useEffect(() => {\n    if (slug) {\n      getArticleBySlug(slug).then((res) => {\n        const article = res.data.article;\n        setFieldValue(\"title\", article.title);\n        setFieldValue(\"description\", article.description);\n        setFieldValue(\"content\", article.body);\n        setTags(article.tagList);\n      });\n    }\n  }, [slug, setFieldValue]);\n\n  const onKeyDown = (e: KeyboardEvent<HTMLInputElement>) => {\n    const { key } = e;\n    const trimmedInput = input.trim();\n\n    if (\n      key === \"Enter\" &&\n      trimmedInput.length &&\n      !tags?.includes(trimmedInput)\n    ) {\n      e.preventDefault();\n      setTags((prevState) => [...prevState, trimmedInput]);\n      setInput(\"\");\n    }\n\n    if (key === \"Backspace\" && !input.length && tags.length) {\n      e.preventDefault();\n      const tagsCopy = [...tags];\n      const poppedTag = tagsCopy.pop() as string;\n\n      setTags(tagsCopy);\n      setInput(poppedTag);\n    }\n  };\n\n  const onChange = (e: ChangeEvent<HTMLInputElement>) => {\n    const { value } = e.target;\n    setInput(value);\n  };\n\n  const onKeyUp = () => {};\n\n  return (\n    <div className=\"editor-page\">\n      <div className=\"container page\">\n        <div className=\"row\">\n          <div className=\"col-md-10 offset-md-1 col-xs-12\">\n            <form onSubmit={handleSubmit}>\n              <fieldset>\n                <fieldset className=\"form-group\">\n                  <p className=\"error-messages\">{props.errors.title}</p>\n                  <input\n                    type=\"text\"\n                    className=\"form-control form-control-lg\"\n                    placeholder=\"Article Title\"\n                    name=\"title\"\n                    value={props.values.title}\n                    onChange={props.handleChange}\n                  />\n                </fieldset>\n                <fieldset className=\"form-group\">\n                  <p className=\"error-messages\">{props.errors.description}</p>\n                  <textarea\n                    rows={6}\n                    className=\"form-control\"\n                    placeholder=\"What's this article about?\"\n                    name=\"description\"\n                    value={props.values.description}\n                    onChange={props.handleChange}\n                  />\n                </fieldset>\n                <fieldset className=\"form-group\">\n                  <p className=\"error-messages\">{props.errors.content}</p>\n                  <textarea\n                    rows={6}\n                    className=\"form-control\"\n                    placeholder=\"Write your article (in markdown)\"\n                    name=\"content\"\n                    value={props.values.content}\n                    onChange={props.handleChange}\n                  ></textarea>\n                </fieldset>\n                <fieldset className=\"form-group\">\n                  <input\n                    type=\"text\"\n                    className=\"form-control\"\n                    placeholder={slug ? \"Don't change tags\" : \"Enter tags\"}\n                    value={input}\n                    onKeyDown={onKeyDown}\n                    onChange={onChange}\n                    onKeyUp={onKeyUp}\n                  />\n                  <TagList tags={tags} setTags={setTags} />\n                </fieldset>\n                <button\n                  className=\"btn btn-lg pull-xs-right btn-primary\"\n                  disabled={!props.isValid || !props.values.title}\n                >\n                  Publish Article\n                </button>\n              </fieldset>\n            </form>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\nconst FormikEditor = withFormik({\n  mapPropsToValues() {\n    // Init form field\n    return {\n      title: \"\",\n      description: \"\",\n      content: \"\",\n    };\n  },\n  validationSchema: Yup.object().shape({\n    // Validate form field\n    title: Yup.string().required(\"Please provide a title\"),\n    description: Yup.string().required(\"Please provide a description\"),\n    content: Yup.string().required(\"Please provide content\"),\n  }),\n  handleSubmit: () => {},\n})(Editor);\n\nexport default FormikEditor;\n"]},"metadata":{},"sourceType":"module"}